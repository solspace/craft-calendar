"use strict";$(function(){setTimeout(function(){var e=$(".event-creator"),t=$(".lightswitch",e);t.on({change:function(){var t=$(".timewrapper",e);$("input",this).val()?t.fadeOut("fast"):t.fadeIn("fast")}}),e.each(function(){var e=$(this);$("ul.errors",e).empty();var t=$('input[name="startDate[date]"]',e),a=$('input[name="startDate[time]"]',e),i=$('input[name="endDate[date]"]',e),n=$('input[name="endDate[time]"]',e);a.timepicker("option","step",calendarTimeInterval),n.timepicker("option","step",calendarTimeInterval),t.datepicker("option","onSelect",function(e){i.datepicker("option","minDate",e),i.val(e)}),a.on("change",function(){var e=t.datepicker("getDate"),r=i.datepicker("getDate"),m=0;e&&r&&(m=Math.round((r-e)/864e5));var o=a.timepicker("getTime"),p=a.timepicker("getTime");if(o)if(p.setMinutes(o.getMinutes()+parseInt(calendarEventDuration)),n.timepicker("option","durationTime",o),0===m){var c=a.timepicker("getTime");c.setMinutes(o.getMinutes()+parseInt(calendarTimeInterval)),n.timepicker("option","showDuration",!0),n.timepicker("option","minTime",c),$(this).val()&&n.timepicker("setTime",p)}else n.timepicker("option","showDuration",!1),n.timepicker("option","minTime","00:00"),$(this).val()&&n.timepicker("setTime",o)}),i.on("change",function(){a.trigger("change")});var r=$("input[name=allDay]",e),m=r.parents(".lightswitch:first");m.data("lightswitch").turnOff(),$(".timewrapper",e).show(),$(".btn.submit",e).bind("click",function(m){var o=$("input[name=title]",e).val(),p=$("select[name=calendarId]",e).val(),c=moment(t.datepicker("getDate")),s=moment(a.timepicker("getTime")),l=moment(i.datepicker("getDate")),d=moment(n.timepicker("getTime")),u=r.val(),v=c.format("YYYY-MM-DD"),f=l.format("YYYY-MM-DD");u||(v=v+" "+s.format("HH:mm:ss"),f=f+" "+d.format("HH:mm:ss"));var k={startDate:v,endDate:f,allDay:u,event:{title:o,calendarId:p}};return k[csrfTokenName]=csrfTokenValue,$(".spinner",e).removeClass("hidden"),$.ajax({url:Craft.getCpUrl("calendar/events/api/create"),type:"post",dataType:"json",data:k,success:function(t){$(".spinner",e).addClass("hidden"),t.error?($("ul.errors",e).empty().append($("<li />",{text:t.error})),Craft.cp.displayError(Craft.t("calendar","Couldnâ€™t save event."))):t.event&&($("ul.errors",e).empty(),$("input[type=text]",e).val(""),Craft.cp.displayNotice(Craft.t("calendar","Event saved.")))},error:function(e){alert(e)}}),!1})})},200)});